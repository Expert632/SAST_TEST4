name: Pipeline 03 - Auto Remediation

on:
  workflow_dispatch: # Permet de lancer manuellement le pipeline

jobs:
  auto-remediation:
    runs-on: ubuntu-latest
    steps:

      # ------------------------
      # 1Ô∏è‚É£ Checkout repository
      # ------------------------
      - name: Checkout repository
        uses: actions/checkout@v3

      # ------------------------
      # 2Ô∏è‚É£ Setup Python
      # ------------------------
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # ------------------------
      # 3Ô∏è‚É£ Debug: liste tous les fichiers
      # ------------------------
      - name: Debug files in repo
        run: |
          echo "üìÇ Listing all files in repo:"
          ls -R

      # ------------------------
      # 4Ô∏è‚É£ Run auto remediation script
      # ------------------------
      - name: Run auto remediation script
        run: |
          python scripts/auto_remediate.py || echo "‚ö†Ô∏è Auto-remediation script failed but ignored for lab"

      # ------------------------
      # 5Ô∏è‚É£ Generate remediation report
      # ------------------------
      - name: Generate remediation report
        run: |
          python scripts/remediation_report.py || echo "‚ö†Ô∏è Remediation report generation failed but ignored for lab"

      # ------------------------
      # 6Ô∏è‚É£ Upload report as artifact
      # ------------------------
      - name: Upload remediation summary
        uses: actions/upload-artifact@v3
        with:
          name: remediation-summary
          path: sast-reports/remediation-summary.txt
