name: Pipeline 03 - Auto Remediation

on:
  workflow_dispatch:   # lancement manuel
  workflow_call:       # ou appel depuis un autre pipeline

jobs:
  auto-remediate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install --upgrade pip

      # --- Ã‰tape 1 : RemÃ©diation automatique ---
      - name: Run auto remediation script
        run: |
          echo "ðŸš€ Launching automatic remediation..."
          python scripts/auto_remediate.py

      # --- Ã‰tape 2 : GÃ©nÃ©rer le rapport de synthÃ¨se CVE ---
      - name: Generate remediation summary report
        run: |
          echo "ðŸ“Š Analyzing before/after SAST reports..."
          python scripts/remediation_report.py

      # --- Ã‰tape 3 : Upload des logs et rapports ---
      - name: Upload remediation artifacts
        uses: actions/upload-artifact@v4
        with:
          name: remediation-artifacts
          path: |
            scripts/
            sast-reports/remediation-summary.txt
